

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Terraform Background &mdash; terraform-iac-lab  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Panorama Configuration" href="configure.html" />
    <link rel="prev" title="Setup" href="../01-getting-started/setup.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> terraform-iac-lab
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../00-overview/introduction.html">Lab Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../01-getting-started/requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-getting-started/setup.html">Setup</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">configure</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Terraform Background</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#terraform-at-a-glance">Terraform At a Glance</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-overview">Configuration Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#many-files-one-configuration">Many Files, One Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#state-management">State Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-terraform-configuration">Example Terraform Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#terminology">Terminology</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#plan">Plan</a></li>
<li class="toctree-l3"><a class="reference internal" href="#provider">Provider</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resource">Resource</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-source">Data Source</a></li>
<li class="toctree-l3"><a class="reference internal" href="#attribute">Attribute</a></li>
<li class="toctree-l3"><a class="reference internal" href="#variables">Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modules">Modules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#common-commands">Common Commands</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configure.html">Panorama Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">deploy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../03-deploy/deploy.html">Lab Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-deploy/validation.html">Validation Testing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">summary</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../05-summary/summary.html">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05-summary/cleanup.html">Cleaning Up</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05-summary/moreinfo.html">Further Reading</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../06-appendix/terraform-commit.html">Terraform and Commits</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">terraform-iac-lab</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Terraform Background</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/02-configure/terraform.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="terraform-background">
<h1>Terraform Background<a class="headerlink" href="#terraform-background" title="Permalink to this headline">¶</a></h1>
<div class="section" id="terraform-at-a-glance">
<h2>Terraform At a Glance<a class="headerlink" href="#terraform-at-a-glance" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Company: <a class="reference external" href="https://www.hashicorp.com/">HashiCorp</a></p></li>
<li><p>Integration First Available: January 2018</p></li>
<li><p>Configuration: HCL (HashiCorp Configuration Language)</p></li>
<li><p><a class="reference external" href="https://www.terraform.io/docs/providers/panos/index.html">PAN-OS Terraform Provider</a></p></li>
<li><p><a class="reference external" href="https://github.com/terraform-providers/terraform-provider-panos">GitHub Repo</a></p></li>
<li><p>Implementation Language: golang</p></li>
</ul>
</div>
<div class="section" id="configuration-overview">
<h2>Configuration Overview<a class="headerlink" href="#configuration-overview" title="Permalink to this headline">¶</a></h2>
<div class="section" id="many-files-one-configuration">
<h3>Many Files, One Configuration<a class="headerlink" href="#many-files-one-configuration" title="Permalink to this headline">¶</a></h3>
<p>Terraform allows you to split your configuration into as many files as you
wish.  Any Terraform file in the current working directory will be loaded and
concatenated with the others when you tell Terraform to apply your desired
configuration.</p>
</div>
<div class="section" id="state-management">
<h3>State Management<a class="headerlink" href="#state-management" title="Permalink to this headline">¶</a></h3>
<p>Terraform saves details about a deployment it has done to a file referred
to as a “state file”.  While this state file can be stored locally from the
host on which a deployment has been executed, it is best practice to store
the state file remotely so that collaborators can manage infrastructure from
a common state file.  Terraform Enterprise and Terraform Cloud both provide
centralized state management, but it can also be done using cloud storage
capabilities.</p>
<p>If changes are made to infrastructure that was deployed by Terraform, the
state file may differ from what’s actually deployed.  This is actually not
a big deal, as many of Terraform’s commands do a Read operation to check the
actual state against what’s saved in the state file.  Any changes that are
found are then saved to the state file automatically.</p>
</div>
<div class="section" id="example-terraform-configuration">
<h3>Example Terraform Configuration<a class="headerlink" href="#example-terraform-configuration" title="Permalink to this headline">¶</a></h3>
<p>Here’s an example of a Terraform configuration file.  We will discuss the
parts of this config below.</p>
<div class="highlight-terraform notranslate"><div class="highlight"><pre><span></span> <span class="kr">variable</span> <span class="nv">&quot;hostname&quot;</span> <span class="p">{</span>
     <span class="na">default</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>
 <span class="p">}</span>

 <span class="kr">variable</span> <span class="nv">&quot;username&quot;</span> <span class="p">{</span>
     <span class="na">default</span> <span class="o">=</span> <span class="s2">&quot;admin&quot;</span>
 <span class="p">}</span>

 <span class="kr">variable</span> <span class="nv">&quot;password&quot;</span> <span class="p">{</span>
     <span class="na">default</span> <span class="o">=</span> <span class="s2">&quot;admin&quot;</span>
 <span class="p">}</span>

 <span class="kr">provider</span> <span class="nv">&quot;panos&quot;</span> <span class="p">{</span>
     <span class="na">hostname</span> <span class="o">=</span> <span class="nv">var.hostname</span>
     <span class="na">username</span> <span class="o">=</span> <span class="nv">var.username</span>
     <span class="na">password</span> <span class="o">=</span> <span class="nv">var.password</span>
 <span class="p">}</span>

 <span class="kr">resource</span> <span class="nc">&quot;panos_management_profile&quot;</span> <span class="nv">&quot;ssh&quot;</span> <span class="p">{</span>
     <span class="na">name</span> <span class="o">=</span> <span class="s2">&quot;allow ssh&quot;</span>
     <span class="na">ssh</span> <span class="o">=</span> <span class="no">true</span>
 <span class="p">}</span>

 <span class="kr">resource</span> <span class="nc">&quot;panos_ethernet_interface&quot;</span> <span class="nv">&quot;eth1&quot;</span> <span class="p">{</span>
     <span class="na">name</span> <span class="o">=</span> <span class="s2">&quot;ethernet1/1&quot;</span>
     <span class="na">vsys</span> <span class="o">=</span> <span class="s2">&quot;vsys1&quot;</span>
     <span class="na">mode</span> <span class="o">=</span> <span class="s2">&quot;layer3&quot;</span>
     <span class="na">enable_dhcp</span> <span class="o">=</span> <span class="no">true</span>
     <span class="na">management_profile</span> <span class="o">=</span> <span class="nv">panos_management_profile.ssh.name</span>
 <span class="p">}</span>

 <span class="kr">resource</span> <span class="nc">&quot;panos_zone&quot;</span> <span class="nv">&quot;zone1&quot;</span> <span class="p">{</span>
     <span class="na">name</span> <span class="o">=</span> <span class="s2">&quot;L3-in&quot;</span>
     <span class="na">mode</span> <span class="o">=</span> <span class="s2">&quot;layer3&quot;</span>
     <span class="na">interfaces</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ethernet1/1&quot;</span><span class="p">]</span>
     <span class="na">depends_on</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;panos_ethernet_interface.eth1&quot;</span><span class="p">]</span>
 <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="terminology">
<h2>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h2>
<div class="section" id="plan">
<h3>Plan<a class="headerlink" href="#plan" title="Permalink to this headline">¶</a></h3>
<p>A Terraform <strong>plan</strong> is the sum of all Terraform configuration files
in a given directory.  These files are generally written in <em>HCL</em>.</p>
</div>
<div class="section" id="provider">
<h3>Provider<a class="headerlink" href="#provider" title="Permalink to this headline">¶</a></h3>
<p>A <strong>provider</strong> can loosely thought of to be a product (such as the Palo Alto
Networks firewall) or a service (such as AWS, Azure, or GCP).  The provider
understands the underlying API to the product or service, making individual
parts of those things available as <em>resources</em>.</p>
<p>Most providers require some kind of configuration in order to use.  For the
<code class="docutils literal notranslate"><span class="pre">panos</span></code> provider, this is the authentication credentials of the firewall or
Panorama that you want to configure.</p>
<p>Providers are configured in a provider configuration block (e.g. -
<code class="docutils literal notranslate"><span class="pre">provider</span> <span class="pre">&quot;panos&quot;</span> <span class="pre">{...}</span></code>, and a plan can make use of any number of providers,
all working together.</p>
</div>
<div class="section" id="resource">
<h3>Resource<a class="headerlink" href="#resource" title="Permalink to this headline">¶</a></h3>
<p>A <strong>resource</strong> is an individual component that a provider supports
create/read/update/delete operations for.</p>
<p>For the Palo Alto Networks firewall, this would be something like
an ethernet interface, service object, or an interface management profile.</p>
</div>
<div class="section" id="data-source">
<h3>Data Source<a class="headerlink" href="#data-source" title="Permalink to this headline">¶</a></h3>
<p>A <strong>data source</strong> is like a resource, but read-only.</p>
<p>For example, the <code class="docutils literal notranslate"><span class="pre">panos</span></code> provider has a
<a class="reference external" href="https://www.terraform.io/docs/providers/panos/d/system_info.html">data source</a>
that gives you access to the results of <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">system</span> <span class="pre">info</span></code>.</p>
</div>
<div class="section" id="attribute">
<h3>Attribute<a class="headerlink" href="#attribute" title="Permalink to this headline">¶</a></h3>
<p>An <strong>attribute</strong> is a single parameter that exists in either a resource or a
data source.  Individual attributes are specific to the resource itself, as to
what type it is, if it’s required or optional, has a default value, or if
changing it would require the whole resource to be recreated or not.</p>
<p>Attributes can have a few different types:</p>
<ul class="simple">
<li><p><em>String</em>:  <code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;bar&quot;</span></code></p></li>
<li><p><em>Number</em>: <code class="docutils literal notranslate"><span class="pre">7</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;42&quot;</span></code> (quoting numbers is fine in HCL)</p></li>
<li><p><em>List</em>: <code class="docutils literal notranslate"><span class="pre">[&quot;item1&quot;,</span> <span class="pre">&quot;item2&quot;]</span></code></p></li>
<li><p><em>Boolean*</em>: <code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code></p></li>
<li><p><em>Map</em>: <code class="docutils literal notranslate"><span class="pre">{&quot;key&quot;:</span> <span class="pre">&quot;value&quot;}</span></code> (some maps may have more complex values)</p></li>
</ul>
</div>
<div class="section" id="variables">
<h3>Variables<a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h3>
<p>Terraform plans can have <em>variables</em> to allow for more flexibility.  These
variables come in two flavors:  user variables and attribute variables.
Whenever you want to use variables (or any other Terraform interpolation),
you’ll be enclosing it in curly braces with a leading dollar sign: <code class="docutils literal notranslate"><span class="pre">&quot;${...}&quot;</span></code></p>
<p>User variables are variables that are defined in the Terraform plan file
with the <code class="docutils literal notranslate"><span class="pre">variable</span></code> keyword.  These can be any of the types of values that
attributes can be (default is string), and can also be configured to have
default values.  When using a user variable in your plan files, they are
referenced with <code class="docutils literal notranslate"><span class="pre">var</span></code> as a prefix: <code class="docutils literal notranslate"><span class="pre">var.hostname</span></code>.  Terraform looks
for local variable values in the file <code class="docutils literal notranslate"><span class="pre">terraform.tfvars</span></code>.</p>
<p>Attribute variables are variables that reference other resources or data
sources within the same plan.  Specifying a resource attribute using an
attribute variable creates an implicit dependency, covered below.</p>
</div>
<div class="section" id="dependencies">
<h3>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h3>
<p>There are two ways to tell Terraform that resource “A” needs to be created
before resource “B”:  the universal <em>depends_on</em> resource parameter or an
attribute variable.  The first way, using <em>depends_on</em>, is performed by
adding the universal parameter “depends_on” within the dependent
resource.  The second way, using attribute variables, is performed by
referencing a resource or data source attribute as a variable:
<code class="docutils literal notranslate"><span class="pre">panos_management_profile.ssh.name</span></code></p>
</div>
<div class="section" id="modules">
<h3>Modules<a class="headerlink" href="#modules" title="Permalink to this headline">¶</a></h3>
<p>Terraform can group resources together in reusable pieces called <em>modules</em>.
Modules often have input variables to allow for customization, and output
variable so that the resources they create can be accessed.  This lab uses
modules to group together elements for the base networking components, the
firewall, and the created instances.</p>
<p>For example, the firewall configuration is located in
<code class="docutils literal notranslate"><span class="pre">deployment/modules/firewall</span></code>.  Calling this module creates the firewall
instance, the network interfaces, and various other resources.</p>
<p>It can be used in another Terraform plan like this:</p>
<div class="highlight-terraform notranslate"><div class="highlight"><pre><span></span> <span class="kr">module</span> <span class="nv">&quot;firewall&quot;</span> <span class="p">{</span>
     <span class="na">source</span> <span class="o">=</span> <span class="s2">&quot;./modules/firewall&quot;</span>

     <span class="na">fw_name</span>             <span class="o">=</span> <span class="s2">&quot;vm-series&quot;</span>
     <span class="na">fw_zone</span>             <span class="o">=</span> <span class="nv">var.zone</span>
     <span class="na">fw_image</span>            <span class="o">=</span> <span class="s2">&quot;https://www.googleapis.com/compute/v1/projects/paloaltonetworksgcp-public/global/images/vmseries-bundle2-901&quot;</span>
     <span class="na">fw_machine_type</span>     <span class="o">=</span> <span class="s2">&quot;n1-standard-4&quot;</span>
     <span class="na">fw_machine_cpu</span>      <span class="o">=</span> <span class="s2">&quot;Intel Skylake&quot;</span>
     <span class="na">fw_bootstrap_bucket</span> <span class="o">=</span> <span class="nv">module.bootstrap.bootstrap_name</span>

     <span class="na">fw_ssh_key</span> <span class="o">=</span> <span class="s2">&quot;admin:${file(var.public_key_file)}&quot;</span>

     <span class="na">fw_mgmt_subnet</span> <span class="o">=</span> <span class="nv">module.vpc.mgmt_subnet</span>
     <span class="na">fw_mgmt_ip</span>     <span class="o">=</span> <span class="s2">&quot;10.5.0.4&quot;</span>
     <span class="na">fw_mgmt_rule</span>   <span class="o">=</span> <span class="nv">module.vpc.mgmt-allow-inbound-rule</span>

     <span class="na">fw_untrust_subnet</span> <span class="o">=</span> <span class="nv">module.vpc.untrust_subnet</span>
     <span class="na">fw_untrust_ip</span>     <span class="o">=</span> <span class="s2">&quot;10.5.1.4&quot;</span>
     <span class="na">fw_untrust_rule</span>   <span class="o">=</span> <span class="nv">module.vpc.untrust-allow-inbound-rule</span>

     <span class="na">fw_web_subnet</span> <span class="o">=</span> <span class="nv">module.vpc.web_subnet</span>
     <span class="na">fw_web_ip</span>     <span class="o">=</span> <span class="s2">&quot;10.5.2.4&quot;</span>
     <span class="na">fw_web_rule</span>   <span class="o">=</span> <span class="nv">module.vpc.web-allow-outbound-rule</span>

     <span class="na">fw_db_subnet</span> <span class="o">=</span> <span class="nv">module.vpc.db_subnet</span>
     <span class="na">fw_db_ip</span>     <span class="o">=</span> <span class="s2">&quot;10.5.3.4&quot;</span>
     <span class="na">fw_db_rule</span>   <span class="o">=</span> <span class="nv">module.vpc.db-allow-outbound-rule</span>
 <span class="p">}</span>
</pre></div>
</div>
<p>This calls the firewall module, and passes in values for the variables it
requires.</p>
</div>
</div>
<div class="section" id="common-commands">
<h2>Common Commands<a class="headerlink" href="#common-commands" title="Permalink to this headline">¶</a></h2>
<p>The Terraform binary has many different CLI arguments that it supports.  We’ll
discuss only a few of them here:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ terraform init
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">terraform</span> <span class="pre">init</span></code> initializes the current directory based off of the local
plan files, downloading any missing provider binaries or modules.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ terraform plan
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">terraform</span> <span class="pre">plan</span></code> refreshes provider/resource states and reports what changes
need to take place.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ terraform apply
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">terraform</span> <span class="pre">apply</span></code> refreshes provider/resource states and makes any needed
changes to the resources.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ terraform destroy
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">terraform</span> <span class="pre">destroy</span></code> refreshes provider/resource states and removes all
resources that Terraform created.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="configure.html" class="btn btn-neutral float-right" title="Panorama Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../01-getting-started/setup.html" class="btn btn-neutral float-left" title="Setup" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Palo Alto Networks.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>