

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Panorama Configuration &mdash; terraform-iac-lab  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lab Deployment" href="../03-deploy/deploy.html" />
    <link rel="prev" title="Terraform Background" href="terraform.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> terraform-iac-lab
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../00-overview/introduction.html">Introduction</a></li>
</ul>
<p class="caption"><span class="caption-text">getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../01-getting-started/requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01-getting-started/setup.html">Setup</a></li>
</ul>
<p class="caption"><span class="caption-text">configure</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="terraform.html">Terraform Background</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Panorama Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#provider-initialization">Provider Initialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#network-interfaces">Network Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="#virtual-router">Virtual Router</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">Security Zones</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">deploy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../03-deploy/deploy.html">Lab Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-deploy/validation.html">Validation Testing</a></li>
</ul>
<p class="caption"><span class="caption-text">respond</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../04-respond/monitor.html">Cloud Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04-respond/dag.html">Dynamic Address Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04-respond/scale-out.html">Compute Scaling</a></li>
</ul>
<p class="caption"><span class="caption-text">summary</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../05-summary/summary.html">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05-summary/comparison.html">Tool Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05-summary/cleanup.html">Cleaning Up</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05-summary/moreinfo.html">Further Reading</a></li>
</ul>
<p class="caption"><span class="caption-text">appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../06-appendix/terraform-commit.html">Terraform and Commits</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">terraform-iac-lab</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Panorama Configuration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/02-configure/configure.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="panorama-configuration">
<h1>Panorama Configuration<a class="headerlink" href="#panorama-configuration" title="Permalink to this headline">¶</a></h1>
<p>In this activity you will:</p>
<ul class="simple">
<li>Initialize the Provider</li>
<li>Configure Network Interfaces</li>
<li>Configure Virtual Router</li>
<li>Configure Security Zones</li>
</ul>
<p>For this portion of the lab, you will be using the Palo Alto Networks
<a class="reference external" href="https://www.terraform.io/docs/providers/panos/index.html">Terraform for PAN-OS provider</a>.</p>
<p>First, change to the Terraform configuration directory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/multicloud-automation-lab/configuration/terraform
</pre></div>
</div>
<div class="section" id="provider-initialization">
<h2>Provider Initialization<a class="headerlink" href="#provider-initialization" title="Permalink to this headline">¶</a></h2>
<p>Your first task is to set up the communications between the provider and your
lab firewall.  There’s several ways this can be done.  The IP address,
username, and password (or API key) can be set as variables in Terraform, and
can be typed in manually each time the Terraform plan is run, or specified on
the command line using the <code class="docutils literal notranslate"><span class="pre">-var</span></code> command line option to <code class="docutils literal notranslate"><span class="pre">terraform</span> <span class="pre">plan</span></code>
and <code class="docutils literal notranslate"><span class="pre">terraform</span> <span class="pre">apply</span></code>.  You can also reference a JSON file in the provider
configuration which can contain the configuration.</p>
<p>Another way you can accomplish this is by using environment variables.  Use the
following commands to add the appropriate environment variables:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">PANOS_HOSTNAME</span><span class="o">=</span><span class="s2">&quot;&lt;YOUR FIREWALL MGMT IP GOES HERE&gt;&quot;</span>
$ <span class="nb">export</span> <span class="nv">PANOS_USERNAME</span><span class="o">=</span><span class="s2">&quot;admin&quot;</span>
$ <span class="nb">export</span> <span class="nv">PANOS_PASSWORD</span><span class="o">=</span><span class="s2">&quot;Ignite2019!&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Replace the text <code class="docutils literal notranslate"><span class="pre">&lt;YOUR</span> <span class="pre">FIREWALL</span> <span class="pre">MGMT</span> <span class="pre">IP</span> <span class="pre">GOES</span> <span class="pre">HERE&gt;</span></code> with your firewall’s management IP address.</p>
</div>
<p>Now, you should see the variables exported in your shell, which you can verify
using the <code class="docutils literal notranslate"><span class="pre">env</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">PANOS</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">PANOS_HOSTNAME</span><span class="o">=</span><span class="m">3</span>.216.53.203
<span class="nv">PANOS_USERNAME</span><span class="o">=</span>admin
<span class="nv">PANOS_PASSWORD</span><span class="o">=</span>Ignite2019!
</pre></div>
</div>
<p>With these values defined, we can now initialize the Terraform panos provider with the following command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ terraform init
</pre></div>
</div>
<p>The provider is now ready to communicate with our firewall.</p>
</div>
<div class="section" id="network-interfaces">
<h2>Network Interfaces<a class="headerlink" href="#network-interfaces" title="Permalink to this headline">¶</a></h2>
<p>Your firewall has been bootstrapped with an initial password and nothing else.
We’re going to be performing the initial networking configuration with
Terraform.</p>
<p>You’ve been provided with the following Terraform plan in <code class="docutils literal notranslate"><span class="pre">main.tf</span></code>:</p>
<div class="highlight-terraform notranslate"><div class="highlight"><pre><span></span><span class="kr">provider</span> <span class="s">&quot;panos&quot;</span> <span class=" -Punctuation">{}</span>

<span class="kr">resource</span> <span class="s">&quot;panos_ethernet_interface&quot; &quot;untrust&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">    name</span>                      <span class="o">=</span> <span class="s2">&quot;ethernet1/1&quot;</span>
<span class="na">    vsys</span>                      <span class="o">=</span> <span class="s2">&quot;vsys1&quot;</span>
<span class="na">    mode</span>                      <span class="o">=</span> <span class="s2">&quot;layer3&quot;</span>
<span class="na">    enable_dhcp</span>               <span class="o">=</span> <span class="kt">true</span>
<span class="na">    create_dhcp_default_route</span> <span class="o">=</span> <span class="kt">true</span>
<span class=" -Punctuation">}</span>

<span class="kr">resource</span> <span class="s">&quot;panos_ethernet_interface&quot; &quot;web&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">    name</span>        <span class="o">=</span> <span class="s2">&quot;ethernet1/2&quot;</span>
<span class="na">    vsys</span>        <span class="o">=</span> <span class="s2">&quot;vsys1&quot;</span>
<span class="na">    mode</span>        <span class="o">=</span> <span class="s2">&quot;layer3&quot;</span>
<span class="na">    enable_dhcp</span> <span class="o">=</span> <span class="kt">true</span>
<span class=" -Punctuation">}</span>

<span class="kr">resource</span> <span class="s">&quot;panos_ethernet_interface&quot; &quot;db&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">    name</span>        <span class="o">=</span> <span class="s2">&quot;ethernet1/3&quot;</span>
<span class="na">    vsys</span>        <span class="o">=</span> <span class="s2">&quot;vsys1&quot;</span>
<span class="na">    mode</span>        <span class="o">=</span> <span class="s2">&quot;layer3&quot;</span>
<span class="na">    enable_dhcp</span> <span class="o">=</span> <span class="kt">true</span>
<span class=" -Punctuation">}</span>
</pre></div>
</div>
<p>This configuration creates your network interfaces.  The PAN-OS provider
doesn’t need any additional configuration specified because it is pulling that
information from the environment variables we set earlier.</p>
<p>Now, you can run <code class="docutils literal notranslate"><span class="pre">terraform</span> <span class="pre">apply</span></code>, and the interfaces will be created on the
firewall.</p>
</div>
<div class="section" id="virtual-router">
<h2>Virtual Router<a class="headerlink" href="#virtual-router" title="Permalink to this headline">¶</a></h2>
<p>Now, you’ll have to assign those interfaces to the default virtual router.
You will need the
<a class="reference external" href="https://www.terraform.io/docs/providers/panos/r/virtual_router.html">panos_virtual_router</a>
resource.</p>
<p>The example code from that page looks like this:</p>
<div class="highlight-terraform notranslate"><div class="highlight"><pre><span></span><span class="kr">resource</span> <span class="s">&quot;panos_virtual_router&quot; &quot;example&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">    name</span> <span class="o">=</span> <span class="s2">&quot;my virtual router&quot;</span>
<span class="na">    static_dist</span> <span class="o">=</span> <span class="m">15</span>
<span class="na">    interfaces</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ethernet1/1&quot;, &quot;ethernet1/2&quot;</span><span class="p">]</span>
<span class=" -Punctuation">}</span>
</pre></div>
</div>
<p>Your version will be similar, but it should have the following definition:</p>
<div class="figure" id="id2">
<img alt="02-configure/vr.png" src="02-configure/vr.png" />
<p class="caption"><span class="caption-text">Virtual router <strong>default</strong>.</span></p>
</div>
<p>Specifying the static distance isn’t required.</p>
<p>Define the virtual router resource in <code class="docutils literal notranslate"><span class="pre">main.tf</span></code>, and run <code class="docutils literal notranslate"><span class="pre">terraform</span> <span class="pre">apply</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>AWS and GCP have slight differences in the way that routing has to
be configured.  <strong>If you chose GCP as your cloud, you have an additional
step!</strong></p>
<p class="last">If you chose AWS, please continue to <a class="reference external" href="#security-zones">Security Zones</a> section and skip the following.</p>
</div>
<p>GCP requires static routes for each subnet to be defined on the virtual router.
You will need the <a class="reference external" href="https://www.terraform.io/docs/providers/panos/r/static_route_ipv4.html">panos_static_route_ipv4</a>
resource.</p>
<p>The example code from that page looks like this:</p>
<div class="highlight-terraform notranslate"><div class="highlight"><pre><span></span><span class="kr">resource</span> <span class="s">&quot;panos_static_route_ipv4&quot; &quot;example&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">    name</span> <span class="o">=</span> <span class="s2">&quot;localnet&quot;</span>
<span class="na">    virtual_router</span> <span class="o">=</span> <span class="s2">&quot;${panos_virtual_router.vr1.name}&quot;</span>
<span class="na">    destination</span> <span class="o">=</span> <span class="s2">&quot;10.1.7.0/32&quot;</span>
<span class="na">    next_hop</span> <span class="o">=</span> <span class="s2">&quot;10.1.7.4&quot;</span>
<span class=" -Punctuation">}</span>

<span class="kr">resource</span> <span class="s">&quot;panos_virtual_router&quot; &quot;vr1&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">    name</span> <span class="o">=</span> <span class="s2">&quot;my virtual router&quot;</span>
<span class=" -Punctuation">}</span>
</pre></div>
</div>
<p>This code adds a static route named <em>localnet</em>, that routes traffic destined to
the network <em>10.1.7.0/32</em> to the next hop of <em>10.1.7.4</em>.</p>
<p>You will need to create three resources for the static routes depicted below:</p>
<div class="figure" id="id3">
<img alt="02-configure/gcp_static_routes.png" src="02-configure/gcp_static_routes.png" />
<p class="caption"><span class="caption-text">Static routes needed in GCP.</span></p>
</div>
<p>Define those resources in <code class="docutils literal notranslate"><span class="pre">main.tf</span></code>, and run <code class="docutils literal notranslate"><span class="pre">terraform</span> <span class="pre">apply</span></code>.</p>
</div>
<div class="section" id="id1">
<h2>Security Zones<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Next is creating the security zones for the firewall.  You will need the
<a class="reference external" href="https://www.terraform.io/docs/providers/panos/r/zone.html">panos_zone</a> resource.</p>
<p>The example code from that page looks like this:</p>
<div class="highlight-terraform notranslate"><div class="highlight"><pre><span></span><span class="kr">resource</span> <span class="s">&quot;panos_zone&quot; &quot;example&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">    name</span> <span class="o">=</span> <span class="s2">&quot;myZone&quot;</span>
<span class="na">    mode</span> <span class="o">=</span> <span class="s2">&quot;layer3&quot;</span>
<span class="na">    interfaces</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;${panos_ethernet_interface.e1.name}&quot;, &quot;${panos_ethernet_interface.e5.name}&quot;</span><span class="p">]</span>
<span class="na">    enable_user_id</span> <span class="o">=</span> <span class="kt">true</span>
<span class="na">    exclude_acls</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;192.168.0.0/16&quot;</span><span class="p">]</span>
<span class=" -Punctuation">}</span>

<span class="kr">resource</span> <span class="s">&quot;panos_ethernet_interface&quot; &quot;e1&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">    name</span> <span class="o">=</span> <span class="s2">&quot;ethernet1/1&quot;</span>
<span class="na">    mode</span> <span class="o">=</span> <span class="s2">&quot;layer3&quot;</span>
<span class=" -Punctuation">}</span>

<span class="kr">resource</span> <span class="s">&quot;panos_ethernet_interface&quot; &quot;e5&quot;</span> <span class=" -Punctuation">{</span>
<span class="na">    name</span> <span class="o">=</span> <span class="s2">&quot;ethernet1/5&quot;</span>
<span class="na">    mode</span> <span class="o">=</span> <span class="s2">&quot;layer3&quot;</span>
<span class=" -Punctuation">}</span>
</pre></div>
</div>
<p>You need to create three security zones (similar to <code class="docutils literal notranslate"><span class="pre">e1</span></code> or <code class="docutils literal notranslate"><span class="pre">e5</span></code> in this example),
but they need to have the following definition:</p>
<div class="figure" id="id4">
<img alt="02-configure/untrust_zone.png" src="02-configure/untrust_zone.png" />
<p class="caption"><span class="caption-text">Definition of <strong>untrust-zone</strong>.</span></p>
</div>
<div class="figure" id="id5">
<img alt="02-configure/web_zone.png" src="02-configure/web_zone.png" />
<p class="caption"><span class="caption-text">Definition of <strong>web-zone</strong>.</span></p>
</div>
<div class="figure" id="id6">
<img alt="02-configure/db_zone.png" src="02-configure/db_zone.png" />
<p class="caption"><span class="caption-text">Definition of <strong>db-zone</strong>.</span></p>
</div>
<p>Define those resources in <code class="docutils literal notranslate"><span class="pre">main.tf</span></code>, and run <code class="docutils literal notranslate"><span class="pre">terraform</span> <span class="pre">apply</span></code>.</p>
<p>You’re done with the Terraform portion of the lab!</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../03-deploy/deploy.html" class="btn btn-neutral float-right" title="Lab Deployment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="terraform.html" class="btn btn-neutral float-left" title="Terraform Background" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Palo Alto Networks

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>